<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>AI Studio Lite - Global Insight</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
  <style>
    :root {
      --bg-dark: #0f172a;
      --card-dark: #1e293b;
      --accent-primary: #8b5cf6;
      --accent-secondary: #ec4899;
      --text-main: #f8fafc;
      --text-dim: #94a3b8;
      --pro-gradient: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
      --excel-green: #10b981;
      
      /* ë¸Œëœë“œ ì»¬ëŸ¬ */
      --coupang-red: #E6162D;
      --naver-green: #03C75A;
      --11st-red: #F53D4D;
      --gmarket-green: #02AC56;
      --lotte-red: #ED1C24;
      --auction-red: #D60814;
    }

    * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
    body {
      margin: 0; background-color: var(--bg-dark); color: var(--text-main);
      background-image: radial-gradient(circle at 0% 0%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
      min-height: 100vh; padding: 20px;
    }

    .app-container { max-width: 1200px; margin: 0 auto; }

    /* Header */
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px; }
    .brand h1 { margin: 0; font-size: 1.8rem; background: var(--pro-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: -1px; font-weight: 800; }
    
    .header-btns { display: flex; gap: 10px; align-items: center; }
    
    /* Happy Day ë²„íŠ¼ */
    .btn-shop {
      background: linear-gradient(90deg, #ff9966, #ff5e62);
      color: white; border: none; padding: 10px 20px; border-radius: 99px;
      font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 6px;
      box-shadow: 0 4px 15px rgba(255, 94, 98, 0.4); transition: transform 0.2s;
      animation: pulse 2s infinite;
    }
    .btn-shop:hover { transform: scale(1.05); }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(255, 94, 98, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(255, 94, 98, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 94, 98, 0); }
    }

    .btn-icon { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: var(--text-dim); width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; justify-content: center; align-items: center; font-size: 1.2rem; transition: 0.2s; }
    .btn-icon:hover { background: rgba(255,255,255,0.2); color: white; }

    /* Search & Filter */
    .search-box { background: rgba(30, 41, 59, 0.8); padding: 25px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 25px; }
    .search-row { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
    .region-select { background: #334155; color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 12px; padding: 0 15px; font-weight: bold; cursor: pointer; min-width: 100px; height: 50px; }
    input[type="text"] { flex: 1; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 0 20px; color: white; font-size: 1rem; outline: none; height: 50px; min-width: 200px; }
    input[type="text"]:focus { border-color: var(--accent-primary); }
    button#search-button { background: var(--pro-gradient); color: white; border: none; padding: 0 30px; border-radius: 12px; font-weight: 800; cursor: pointer; white-space: nowrap; height: 50px; }

    .filters-bar { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; }
    .filter-group { display: flex; flex-direction: column; gap: 6px; }
    .filter-group label { font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; font-weight: 700; }
    select { background: var(--card-dark); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 10px; border-radius: 8px; outline: none; cursor: pointer; }

    /* Results */
    .controls-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 0 10px; }
    .view-toggles { display: flex; gap: 5px; background: rgba(255,255,255,0.05); padding: 4px; border-radius: 8px; }
    .view-btn { background: none; border: none; color: var(--text-dim); padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85rem; }
    .view-btn.active { background: var(--card-dark); color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
    #export-excel-btn { background: var(--excel-green); color: white; border: none; padding: 8px 18px; border-radius: 8px; font-weight: 700; cursor: pointer; opacity: 0.5; pointer-events: none; transition: 0.2s; }
    #export-excel-btn.active { opacity: 1; pointer-events: auto; }

    .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
    .video-card { background: var(--card-dark); border-radius: 20px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); transition: transform 0.2s; position: relative; }
    .video-card:hover { transform: translateY(-5px); border-color: var(--accent-primary); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    .thumb-area { position: relative; padding-top: 56.25%; background: #000; }
    .thumb-area img { position: absolute; top:0; left:0; width:100%; height:100%; object-fit: cover; }
    .badge-tier { position: absolute; top:10px; right:10px; background: var(--pro-gradient); padding: 4px 8px; border-radius: 6px; font-size: 0.75rem; font-weight: 800; }
    .badge-duration { position: absolute; bottom:8px; right:8px; background: rgba(0,0,0,0.8); padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; color: white; }
    .video-info { padding: 15px; }
    .video-title { font-size: 0.95rem; font-weight: 700; margin-bottom: 10px; color: white; text-decoration: none; display: block; height: 2.8em; overflow: hidden; line-height: 1.4; }
    .stats-row { display: flex; gap: 10px; margin-bottom: 10px; }
    .stat-box { flex:1; background: rgba(15,23,42,0.5); padding: 8px; border-radius: 8px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
    .stat-label { font-size: 0.65rem; color: var(--text-dim); display: block; }
    .stat-val { font-size: 0.85rem; font-weight: 800; color: var(--accent-primary); }

    .table-wrapper { width: 100%; overflow-x: auto; background: var(--card-dark); border-radius: 16px; padding: 10px; display: none; }
    table { width: 100%; border-collapse: collapse; font-size: 0.85rem; color: var(--text-main); }
    th { text-align: left; padding: 12px; color: var(--text-dim); border-bottom: 1px solid rgba(255,255,255,0.1); white-space: nowrap; }
    td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); vertical-align: middle; }
    .table-thumb { width: 80px; height: 45px; object-fit: cover; border-radius: 4px; }
    .table-title a { color: white; text-decoration: none; font-weight: 600; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

    .footer-hook { margin-top: 60px; padding: 50px; background: rgba(139, 92, 246, 0.05); border-radius: 30px; text-align: center; border: 1px dashed var(--accent-primary); cursor: pointer; }
    .footer-hook h3 { font-size: 1.8rem; margin-bottom: 15px; color: #fff; font-weight: 800; }

    /* Modals */
    .modal { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.95); display: none; justify-content: center; align-items: center; z-index: 2000; padding: 20px; }
    .modal-content { background: var(--card-dark); width: 100%; max-width: 500px; padding: 30px; border-radius: 20px; border: 1px solid var(--accent-primary); position: relative; }
    .modal-close { background: var(--pro-gradient); border: none; color: white; width: 100%; padding: 12px; border-radius: 8px; font-weight: 800; cursor: pointer; margin-top: 15px; }

    /* Shop Modal Styles */
    .shop-modal-content { max-width: 800px; background: #fff; color: #333; overflow-y: auto; max-height: 90vh; }
    .shop-header { text-align: center; margin-bottom: 25px; }
    .shop-header h2 { margin: 0; color: #333; font-size: 1.5rem; }
    
    .shop-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
    .shop-card { 
      display: flex; flex-direction: column; padding: 15px; border-radius: 12px; text-decoration: none; 
      transition: transform 0.2s, box-shadow 0.2s; border: 1px solid #eee; background: #f8fafc;
    }
    .shop-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    .shop-name { font-weight: bold; font-size: 1rem; margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
    
    /* Coupang Special Style */
    .plat-coupang { border: 2px solid var(--coupang-red); background: #fff0f1; grid-column: span 2; }
    .plat-coupang .shop-name { color: var(--coupang-red); font-size: 1.3rem; border-bottom: 1px solid rgba(230,22,45,0.2); padding-bottom: 8px; }

    /* Platform Borders */
    .plat-naver { border-left: 5px solid var(--naver-green); } .plat-naver .shop-name { color: var(--naver-green); }
    .plat-11st { border-left: 5px solid var(--11st-red); } .plat-11st .shop-name { color: var(--11st-red); }
    .plat-gmarket { border-left: 5px solid var(--gmarket-green); } .plat-gmarket .shop-name { color: var(--gmarket-green); }
    .plat-lotte { border-left: 5px solid var(--lotte-red); } .plat-lotte .shop-name { color: var(--lotte-red); }
    .plat-auction { border-left: 5px solid var(--auction-red); } .plat-auction .shop-name { color: var(--auction-red); }

    .link-row { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
    
    /* Coupang Link Button */
    .shop-link-btn { 
      background: white; border: 1px solid #ddd; padding: 10px 20px; border-radius: 8px; 
      font-size: 0.95rem; color: #333; text-decoration: none; font-weight: 700; cursor: pointer;
      display: inline-flex; align-items: center; gap: 6px; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .shop-link-btn:hover { background: #E6162D; color: white; border-color: #E6162D; transform:translateY(-2px); }

    /* Other Links */
    .shop-link { 
      background: white; border: 1px solid #ddd; padding: 6px 12px; border-radius: 6px; 
      font-size: 0.85rem; color: #333; text-decoration: none; font-weight: 600;
      display: inline-flex; align-items: center; gap: 4px; transition: 0.2s;
    }
    .shop-link:hover { background: #eee; border-color: #bbb; }

    /* Guide Modal Styles (Full Version) */
    .modal-guide-content { max-width: 800px; max-height: 90vh; overflow-y: auto; background: #fff; color: #333; padding: 0; }
    .guide-body { padding: 30px; text-align: left; }
    .guide-body h2 { color: #d93025; border-bottom: 2px solid #d93025; padding-bottom: 15px; margin-top: 0; font-size: 1.5rem; text-align: center; }
    
    .step-box { background: white; border: 1px solid #ddd; border-radius: 12px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .step-title { font-size: 1.2rem; font-weight: bold; color: #1a73e8; margin-bottom: 12px; display: flex; align-items: center; gap: 10px; }
    .step-num { background: #1a73e8; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1rem; flex-shrink: 0; }
    
    .guide-btn { display: inline-block; background: #1a73e8; color: white; padding: 12px 24px; text-decoration: none; border-radius: 8px; font-weight: bold; margin: 10px 0; font-size: 0.95rem; }
    .guide-btn:hover { background: #1558b0; }
    .highlight { background: #fff4e5; color: #d93025; padding: 2px 6px; border-radius: 4px; font-weight: bold; border: 1px solid #ffe0b2; }
    .tip-box { background: #e8f0fe; border-left: 4px solid #1a73e8; padding: 15px; margin-top: 15px; font-size: 0.9rem; color: #1e40af; }

    #loading { text-align: center; padding: 50px; display: none; font-weight: 800; color: var(--accent-primary); font-size: 1.2rem; }
  </style>
</head>
<body>

  <div class="app-container">
    <header>
      <div class="brand">
        <h1>AI Studio Lite</h1>
        <p>ê¸€ë¡œë²Œ ìœ íŠœë¸Œ íŠ¸ë Œë“œ ë¶„ì„ê¸°</p>
      </div>
      <div class="header-btns">
        <button class="btn-shop" onclick="openModal('shop-modal')">
          ğŸ›ï¸ Happy Day êµ¬ê²½
        </button>
        <button class="btn-icon" onclick="openModal('guide-modal')" title="ì‚¬ìš© ê°€ì´ë“œ">ğŸ“–</button>
        <button class="btn-icon" onclick="openModal('settings-modal')" title="API ì„¤ì •">âš™ï¸</button>
      </div>
    </header>

    <div class="search-box">
      <form id="search-form">
        <div class="search-row">
          <select id="region-select" class="region-select">
            <option value="KR" selected>ğŸ‡°ğŸ‡· í•œêµ­</option>
            <option value="US">ğŸ‡ºğŸ‡¸ ë¯¸êµ­</option>
            <option value="JP">ğŸ‡¯ğŸ‡µ ì¼ë³¸</option>
            <option value="">ğŸŒ ì „ì„¸ê³„</option>
          </select>
          <input id="search-input" type="text" placeholder="ë¶„ì„í•  í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”..." autocomplete="off" />
          <button id="search-button" type="submit">100ê°œ ë¶„ì„ ì‹œì‘</button>
        </div>
      </form>

      <div class="filters-bar">
        <div class="filter-group">
          <label>ì˜ìƒ ê¸¸ì´</label>
          <select id="length-filter">
            <option value="all">ì „ì²´</option>
            <option value="short">ìˆí¼ (&lt; 60ì´ˆ)</option>
            <option value="long">ë¡±í¼ (â‰¥ 60ì´ˆ)</option>
          </select>
        </div>
        <div class="filter-group">
          <label>ì—…ë¡œë“œ ê¸°ê°„</label>
          <select id="date-filter">
            <option value="all">ì „ì²´</option>
            <option value="1m">ìµœê·¼ 1ê°œì›”</option>
            <option value="2m">ìµœê·¼ 2ê°œì›”</option>
            <option value="6m">ìµœê·¼ 6ê°œì›”</option>
          </select>
        </div>
        <div class="filter-group">
          <label>êµ¬ë…ì ëŒ€ë¹„ ì¡°íšŒ ë“±ê¸‰</label>
          <select id="ratio-filter">
            <option value="all">ì „ì²´ ë“±ê¸‰</option>
            <option value="1">1ë‹¨ê³„: ë¹„ìœ¨ &lt; 0.2</option>
            <option value="2">2ë‹¨ê³„: 0.2 ~ 0.6</option>
            <option value="3">3ë‹¨ê³„: 0.6 ~ 1.4</option>
            <option value="4">4ë‹¨ê³„: 1.4 ~ 3.0</option>
            <option value="5">5ë‹¨ê³„: â‰¥ 3.0 (ëŒ€ë°•)</option>
          </select>
        </div>
        <div class="filter-group">
          <label>ë°ì´í„° ì •ë ¬</label>
          <select id="sort-select">
            <option value="view-desc">ì¡°íšŒìˆ˜ ë‚´ë¦¼ì°¨ìˆœ</option>
            <option value="view-asc">ì¡°íšŒìˆ˜ ì˜¤ë¦„ì°¨ìˆœ</option>
            <option value="date-desc">ì—…ë¡œë“œ ìµœì‹ ìˆœ</option>
            <option value="date-asc">ì—…ë¡œë“œ ì˜¤ë˜ëœìˆœ</option>
            <option value="ratio-desc">ì ì¬ë ¥ ë¹„ìœ¨ ë‚´ë¦¼ì°¨ìˆœ</option>
            <option value="ratio-asc">ì ì¬ë ¥ ë¹„ìœ¨ ì˜¤ë¦„ì°¨ìˆœ</option>
          </select>
        </div>
      </div>
    </div>

    <div class="controls-row">
      <div class="view-toggles">
        <button class="view-btn active" id="view-card-btn">ì¹´ë“œ ë³´ê¸°</button>
        <button class="view-btn" id="view-table-btn">í…Œì´ë¸” ë³´ê¸°</button>
      </div>
      <button id="export-excel-btn">ğŸ“¥ ì—‘ì…€(.xlsx)ë¡œ ì €ì¥</button>
    </div>

    <div id="loading">ğŸš€ 100ê°œì˜ ë°ì´í„°ë¥¼ ì •ë°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>
    
    <div id="results-card" class="cards-grid"></div>
    <div id="results-table" class="table-wrapper">
      <table id="data-table">
        <thead>
          <tr>
            <th>ì¸ë„¤ì¼</th><th>ì œëª©</th><th>ì±„ë„ëª…</th><th>ì¡°íšŒìˆ˜</th><th>êµ¬ë…ì</th><th>ì ì¬ë ¥</th><th>ê¸¸ì´</th><th>ê²Œì‹œì¼</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="footer-hook" onclick="showProMessage()">
      <h3>"10ë¶„ ë§Œì— ì´ëŸ° ì˜ìƒ 100ê°œ ë§Œë“¤ê¸° ì§€ê¸ˆ ì œì‘ì¤‘..."</h3>
      <p>ë‹¨ìˆœ ë¶„ì„ì„ ë„˜ì–´, AIê°€ ìŠ¤í¬ë¦½íŠ¸ë¶€í„° í¸ì§‘ê¹Œì§€ ì™„ë£Œí•˜ëŠ” 'AI Studio Pro'ê°€ ê³§ ê³µê°œë©ë‹ˆë‹¤.</p>
    </div>
  </div>

  <div id="shop-modal" class="modal">
    <div class="modal-content shop-modal-content">
      <div class="shop-header">
        <h2>ğŸ‰ ì˜ìƒ ê¸°ë‹¤ë¦¬ì‹œëŠ” ë™ì•ˆ ~ êµ¬ê²½ì˜¤ì„¸ìš”!</h2>
        <p>í•„ìš”í•œ ë¬¼ê±´ì´ ìˆëŠ”ì§€ í•œë²ˆ ë‘˜ëŸ¬ë³´ì„¸ìš”.</p>
      </div>
      
      <div class="shop-grid">
        <div class="shop-card plat-coupang">
          <div class="shop-name">ğŸŸ¦ ì¿ íŒ¡ (Coupang) <span style="font-size:0.8rem; color:#666; margin-left:auto;">ì¶”ì²œ 1ìˆœìœ„</span></div>
          
          <div style="font-size:0.9rem; color:#333; margin-bottom:15px; line-height:1.5;">
            ğŸ‘‡ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ <strong>ìë™ìœ¼ë¡œ</strong> íŒŒíŠ¸ë„ˆìŠ¤ í˜œíƒ ì ìš© í›„ ìƒì ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤!
          </div>

          <div class="link-row">
            <button class="shop-link-btn" onclick="openCoupangSmart('https://shop.coupang.com/heltopia')">
              ğŸ‘‰ íí† í”¼ì•„ êµ¬ê²½í•˜ê¸°
            </button>
            <button class="shop-link-btn" onclick="openCoupangSmart('https://shop.coupang.com/heltiara')">
              ğŸ‘‰ íí‹°ì•„ë¼ êµ¬ê²½í•˜ê¸°
            </button>
          </div>
        </div>

        <div class="shop-card plat-naver">
          <div class="shop-name">ğŸŸ© ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´</div>
          <div class="link-row">
            <a href="https://smartstore.naver.com/heltiara01" target="_blank" class="shop-link">ğŸ‘‰ ë™í—Œë§ˆíŠ¸</a>
            <a href="https://smartstore.naver.com/heltiara2" target="_blank" class="shop-link">ğŸ‘‰ íí‹°ì•„ë¼</a>
          </div>
        </div>

        <div class="shop-card plat-11st">
          <div class="shop-name">ğŸŸ¨ 11ë²ˆê°€</div>
          <div class="link-row">
            <a href="https://shop.11st.co.kr/stores/1185083" target="_blank" class="shop-link">ğŸ‘‰ íí† í”¼ì•„</a>
            <a href="https://shop.11st.co.kr/stores/1185121" target="_blank" class="shop-link">ğŸ‘‰ íí‹°ì•„ë¼</a>
          </div>
        </div>

        <div class="shop-card plat-gmarket">
          <div class="shop-name">ğŸŸ¦ Gë§ˆì¼“</div>
          <div class="link-row">
            <a href="https://minishop.gmarket.co.kr/heltiara1" target="_blank" class="shop-link">ğŸ‘‰ íí† í”¼ì•„</a>
            <a href="https://minishop.gmarket.co.kr/heltiara2" target="_blank" class="shop-link">ğŸ‘‰ íí‹°ì•„ë¼</a>
          </div>
        </div>

        <div class="shop-card plat-lotte">
          <div class="shop-name">ğŸŸ¥ ë¡¯ë°ì˜¨</div>
          <div class="link-row">
            <a href="https://www.lotteon.com/p/display/seller/sellerShop/LO10168773" target="_blank" class="shop-link">ğŸ‘‰ ë‹¤ì˜¨ëˆ„ë¦¬</a>
            <a href="https://www.lotteon.com/p/display/seller/sellerShop/LO10168919" target="_blank" class="shop-link">ğŸ‘‰ íí‹°ì•„ë¼</a>
          </div>
        </div>

        <div class="shop-card plat-auction">
          <div class="shop-name">ğŸŸª ì˜¥ì…˜</div>
          <div class="link-row">
            <a href="https://stores.auction.co.kr/heltiara1" target="_blank" class="shop-link">ğŸ‘‰ íí† í”¼ì•„</a>
            <a href="https://stores.auction.co.kr/heltiara2" target="_blank" class="shop-link">ğŸ‘‰ íí‹°ì•„ë¼</a>
          </div>
        </div>
      </div>

      <button class="modal-close" onclick="closeModal('shop-modal')">ë‹«ê¸°</button>
    </div>
  </div>

  <div id="guide-modal" class="modal">
    <div class="modal-content modal-guide-content">
      <div class="guide-body">
        <h2>ğŸ”‘ ì™•ì´ˆë³´ API í‚¤ ë°œê¸‰ ê°€ì´ë“œ</h2>
        
        <div class="step-box">
          <div class="step-title"><span class="step-num">1</span> êµ¬ê¸€ í´ë¼ìš°ë“œ ì ‘ì†í•˜ê¸°</div>
          <p>ì•„ë˜ íŒŒë€ ë²„íŠ¼ì„ ëˆŒëŸ¬ êµ¬ê¸€ ê°œë°œì ì‚¬ì´íŠ¸ë¡œ ì´ë™í•˜ì„¸ìš”. (ë¡œê·¸ì¸ í•„ìš”)</p>
          <a href="https://console.cloud.google.com/" target="_blank" class="guide-btn">ğŸ‘‰ êµ¬ê¸€ í´ë¼ìš°ë“œ ì½˜ì†” ë°”ë¡œê°€ê¸°</a>
        </div>

        <div class="step-box">
          <div class="step-title"><span class="step-num">2</span> ìƒˆ í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°</div>
          <p>1. í™”ë©´ ë§¨ ìœ„ìª½ì˜ <strong>[í”„ë¡œì íŠ¸ ì„ íƒ]</strong> ê¸€ìë¥¼ í´ë¦­í•˜ì„¸ìš”.</p>
          <p>2. ë‚˜ì˜¤ëŠ” ì°½ ì˜¤ë¥¸ìª½ ìœ„ì˜ <strong>[ìƒˆ í”„ë¡œì íŠ¸]</strong>ë¥¼ ëˆ„ë¥´ì„¸ìš”.</p>
          <p>3. ì´ë¦„ì— <code>ìœ íŠœë¸Œë¶„ì„ë„êµ¬</code>ë¼ê³  ì ê³  <strong>[ë§Œë“¤ê¸°]</strong>ë¥¼ ëˆ„ë¥´ì„¸ìš”.</p>
          <div class="tip-box">ğŸ’¡ ë§Œë“¤ê³  ë‚˜ì„œ ì ì‹œ í›„, ìƒë‹¨ ë©”ë‰´ì—ì„œ ë°©ê¸ˆ ë§Œë“  í”„ë¡œì íŠ¸ë¥¼ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.</div>
        </div>

        <div class="step-box">
          <div class="step-title"><span class="step-num">3</span> YouTube ê¸°ëŠ¥ ì¼œê¸°</div>
          <p>1. ì™¼ìª½ ìœ„ <strong>[ì¤„ 3ê°œ ë©”ë‰´(â‰¡)]</strong>ë¥¼ ëˆ„ë¥´ì„¸ìš”.</p>
          <p>2. <strong>[API ë° ì„œë¹„ìŠ¤]</strong> â†’ <strong>[ë¼ì´ë¸ŒëŸ¬ë¦¬]</strong>ë¥¼ í´ë¦­í•˜ì„¸ìš”.</p>
          <p>3. ê²€ìƒ‰ì°½ì— <code>youtube</code>ë¥¼ ê²€ìƒ‰í•˜ê³  <strong>[YouTube Data API v3]</strong>ë¥¼ í´ë¦­í•˜ì„¸ìš”.</p>
          <p>4. íŒŒë€ìƒ‰ <strong>[ì‚¬ìš©]</strong> ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>
        </div>

        <div class="step-box">
          <div class="step-title"><span class="step-num">4</span> í‚¤ ìƒì„± ë° ë³µì‚¬</div>
          <p>1. <strong>[ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ë§Œë“¤ê¸°]</strong>ë¥¼ í´ë¦­í•˜ì„¸ìš”.</p>
          <p>2. <strong>[ê³µê°œ ë°ì´í„°]</strong>ë¥¼ ì„ íƒí•˜ê³  ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°€ì„¸ìš”.</p>
          <p>3. í™”ë©´ì— ë‚˜ì˜¨ <span class="highlight">AIza...</span> ë¡œ ì‹œì‘í•˜ëŠ” ê¸´ ì½”ë“œë¥¼ ë³µì‚¬í•˜ì„¸ìš”.</p>
        </div>

        <div class="step-box">
          <div class="step-title"><span class="step-num">5</span> ì•±ì— ì…ë ¥í•˜ê¸°</div>
          <p>ì´ ì°½ì„ ë‹«ê³ , ì•± ì˜¤ë¥¸ìª½ ìƒë‹¨ <strong>[âš™ï¸ ì„¤ì •]</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬ ë³µì‚¬í•œ í‚¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.</p>
        </div>

        <button class="modal-close" onclick="closeModal('guide-modal')">ì´ì œ í•  ìˆ˜ ìˆì–´ìš”! (ë‹«ê¸°)</button>
      </div>
    </div>
  </div>

  <div id="settings-modal" class="modal">
    <div class="modal-content">
      <h2 style="margin-top:0; color:white;">API í‚¤ ì„¤ì •</h2>
      <input id="yt-api-key" type="password" placeholder="AIza..." style="width:100%; padding:15px; background:#0f172a; border:1px solid #334155; color:white; border-radius:12px;" />
      <button id="save-keys" class="modal-close">ì €ì¥</button>
      <button onclick="closeModal('settings-modal')" style="width:100%; background:none; border:none; color:#64748b; margin-top:10px; cursor:pointer;">ë‹«ê¸°</button>
    </div>
  </div>

  <script>
    const LS_KEY = "yt_api_key";
    let YT_API_KEY = localStorage.getItem(LS_KEY) || "";
    document.getElementById('yt-api-key').value = YT_API_KEY;

    let currentVideoData = []; let lastRenderedData = []; let currentViewMode = 'card';

    // --- [ìŠ¤ë§ˆíŠ¸ ì—°ë™ í•µì‹¬] ---
    // 1. ìƒˆ ì°½(ì´ë¦„: coupang_pop)ì— íŒŒíŠ¸ë„ˆìŠ¤ ë§í¬ë¥¼ ì—½ë‹ˆë‹¤. (ìˆ˜ìˆ˜ë£Œ ì ë¦½)
    // 2. ì ì‹œ í›„, ê°™ì€ ì°½(coupang_pop)ì— ìƒì  ë§í¬ë¥¼ ë®ì–´ì”ë‹ˆë‹¤.
    // * ê²°ê³¼: ì•±ì€ ê·¸ëŒ€ë¡œ ìˆê³ , ì™¸ë¶€ ì°½ í•˜ë‚˜ë§Œ ì—´ë ¤ ìµœì¢…ì ìœ¼ë¡œ ìƒì ì— ë„ì°©í•©ë‹ˆë‹¤.
    function openCoupangSmart(targetUrl) {
      const winName = 'coupang_pop';
      
      // 1. íŒŒíŠ¸ë„ˆìŠ¤ ë§í¬ ì—´ê¸°
      window.open('https://link.coupang.com/a/cQpkjC', winName);
      
      // 2. ìƒì  ë§í¬ë¡œ ë®ì–´ì“°ê¸° (1ì´ˆ ë”œë ˆì´)
      setTimeout(() => {
        window.open(targetUrl, winName);
      }, 1000);
    }

    function formatNumber(num) { return Number(num).toLocaleString("ko-KR"); }
    function formatDuration(iso) {
      if (!iso) return "";
      const match = iso.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
      if (!match) return iso;
      const h = parseInt(match[1]||0), m = parseInt(match[2]||0), s = parseInt(match[3]||0);
      let parts = [];
      if(h>0) parts.push(h);
      parts.push(h>0 ? String(m).padStart(2,"0") : m);
      parts.push(String(s).padStart(2,"0"));
      return parts.join(":");
    }
    function getDurationSeconds(iso) {
      if (!iso) return 0;
      const match = iso.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
      if (!match) return 0;
      return (parseInt(match[1]||0)*3600) + (parseInt(match[2]||0)*60) + parseInt(match[3]||0);
    }
    function getRatioLevel(r) {
      if(!r || !isFinite(r) || r<=0) return 0;
      if(r<0.2) return 1; if(r<0.6) return 2; if(r<1.4) return 3; if(r<3) return 4; return 5;
    }

    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function showProMessage() { alert("ğŸ”’ AI Studio ProëŠ” í˜„ì¬ ê°œë°œ ë§ˆë¬´ë¦¬ ë‹¨ê³„ì…ë‹ˆë‹¤.\nê³§ ê³µê°œë©ë‹ˆë‹¤!"); }

    document.getElementById('save-keys').addEventListener('click', () => {
      const val = document.getElementById('yt-api-key').value.trim();
      localStorage.setItem(LS_KEY, val);
      YT_API_KEY = val;
      alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
      closeModal('settings-modal');
    });

    document.getElementById('view-card-btn').addEventListener('click', () => {
      currentViewMode = 'card';
      document.getElementById('view-card-btn').classList.add('active');
      document.getElementById('view-table-btn').classList.remove('active');
      document.getElementById('results-card').style.display = 'grid';
      document.getElementById('results-table').style.display = 'none';
      renderVideos();
    });

    document.getElementById('view-table-btn').addEventListener('click', () => {
      currentViewMode = 'table';
      document.getElementById('view-table-btn').classList.add('active');
      document.getElementById('view-card-btn').classList.remove('active');
      document.getElementById('results-card').style.display = 'none';
      document.getElementById('results-table').style.display = 'block';
      renderVideos();
    });

    document.getElementById('search-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const query = document.getElementById('search-input').value.trim();
      const region = document.getElementById('region-select').value;
      if(!YT_API_KEY) return openModal('settings-modal');
      if(!query) return;

      document.getElementById('loading').style.display = 'block';
      document.getElementById('results-card').innerHTML = '';
      document.querySelector('#data-table tbody').innerHTML = '';
      document.getElementById('export-excel-btn').classList.remove('active');

      try {
        let allItems = []; let nextPageToken = "";
        for(let i=0; i<2; i++) {
          let url = `https://www.googleapis.com/youtube/v3/search?key=${YT_API_KEY}&part=snippet&q=${query}&maxResults=50&type=video&order=viewCount`;
          if(region) url += `&regionCode=${region}`;
          if(nextPageToken) url += `&pageToken=${nextPageToken}`;
          
          const res = await fetch(url);
          if(!res.ok) throw new Error("API ì˜¤ë¥˜: í‚¤ë¥¼ í™•ì¸í•˜ê±°ë‚˜ í• ë‹¹ëŸ‰ì„ ì²´í¬í•˜ì„¸ìš”.");
          const data = await res.json();
          if(data.items) {
            allItems = allItems.concat(data.items);
            nextPageToken = data.nextPageToken;
          }
          if(!nextPageToken) break;
        }

        if(!allItems.length) { alert("ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤."); document.getElementById('loading').style.display='none'; return; }

        const vIds = allItems.map(i => i.id.videoId).filter(Boolean);
        let videoDetails = [];
        for(let i=0; i<vIds.length; i+=50) {
          const chunk = vIds.slice(i, i+50).join(',');
          const vRes = await fetch(`https://www.googleapis.com/youtube/v3/videos?key=${YT_API_KEY}&part=snippet,statistics,contentDetails&id=${chunk}`);
          const vData = await vRes.json();
          if(vData.items) videoDetails = videoDetails.concat(vData.items);
        }

        const cIds = [...new Set(videoDetails.map(v => v.snippet.channelId))].filter(Boolean);
        let channelStats = {};
        for(let i=0; i<cIds.length; i+=50) {
          const chunk = cIds.slice(i, i+50).join(',');
          const cRes = await fetch(`https://www.googleapis.com/youtube/v3/channels?key=${YT_API_KEY}&part=statistics&id=${chunk}`);
          const cData = await cRes.json();
          if(cData.items) cData.items.forEach(c => channelStats[c.id] = c.statistics.subscriberCount);
        }

        currentVideoData = videoDetails.map(video => {
          const viewCount = Number(video.statistics.viewCount||0);
          const subscriberCount = Number(channelStats[video.snippet.channelId]||0);
          const ratio = subscriberCount > 0 ? viewCount/subscriberCount : 0;
          return {
            video, viewCount, subscriberCount, ratio,
            durationSeconds: getDurationSeconds(video.contentDetails.duration),
            publishedAtTime: new Date(video.snippet.publishedAt).getTime(),
            ratioLevel: getRatioLevel(ratio)
          };
        });

        document.getElementById('export-excel-btn').classList.add('active');
        renderVideos();
      } catch (err) { alert(err.message); } 
      finally { document.getElementById('loading').style.display='none'; }
    });

    function renderVideos() {
      const cardContainer = document.getElementById('results-card');
      const tableBody = document.querySelector('#data-table tbody');
      cardContainer.innerHTML = ''; tableBody.innerHTML = '';
      
      const lF = document.getElementById('length-filter').value;
      const dF = document.getElementById('date-filter').value;
      const rF = document.getElementById('ratio-filter').value;
      const sM = document.getElementById('sort-select').value;

      let filtered = currentVideoData.filter(item => {
        if(lF === 'short' && !(item.durationSeconds > 0 && item.durationSeconds < 60)) return false;
        if(lF === 'long' && !(item.durationSeconds >= 60)) return false;
        if(dF !== 'all') {
           const ms = parseInt(dF)*30*24*60*60*1000;
           if(item.publishedAtTime < (Date.now() - ms)) return false;
        }
        if(rF !== 'all' && item.ratioLevel != Number(rF)) return false;
        return true;
      });

      filtered.sort((a,b) => {
        if(sM==='view-desc') return b.viewCount - a.viewCount;
        if(sM==='view-asc') return a.viewCount - b.viewCount;
        if(sM==='date-desc') return b.publishedAtTime - a.publishedAtTime;
        if(sM==='date-asc') return a.publishedAtTime - b.publishedAtTime;
        if(sM==='ratio-desc') return b.ratio - a.ratio;
        if(sM==='ratio-asc') return a.ratio - b.ratio;
        return 0;
      });

      lastRenderedData = filtered;
      if(!filtered.length) { cardContainer.innerHTML='<div style="grid-column:1/-1;text-align:center;color:#94a3b8;padding:20px;">ê²°ê³¼ ì—†ìŒ</div>'; return; }

      filtered.forEach(item => {
        const v = item.video.snippet;
        const thumb = v.thumbnails.high?.url || v.thumbnails.medium?.url;
        const tier = ["-","1","2","3","4","S"][item.ratioLevel] + (item.ratioLevel==5?"-TIER":"ë‹¨ê³„");
        const dur = formatDuration(item.video.contentDetails.duration);
        const date = new Date(item.publishedAtTime).toLocaleDateString();

        if(currentViewMode === 'card') {
          const card = document.createElement('div');
          card.className = 'video-card';
          card.innerHTML = `
            <div class="thumb-area">
              <img src="${thumb}">
              <div class="badge-tier">${tier}</div>
              <div class="badge-duration">${dur}</div>
            </div>
            <div class="video-info">
              <a href="https://youtube.com/watch?v=${item.video.id}" target="_blank" class="video-title">${v.title}</a>
              <div class="stats-row">
                <div class="stat-box"><span class="stat-label">ì¡°íšŒìˆ˜</span><span class="stat-val">${formatNumber(item.viewCount)}</span></div>
                <div class="stat-box"><span class="stat-label">ì ì¬ë ¥</span><span class="stat-val">${item.ratio.toFixed(2)}x</span></div>
              </div>
              <div style="font-size:0.8rem;color:var(--text-dim)">${v.channelTitle}</div>
            </div>`;
          cardContainer.appendChild(card);
        } else {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><img src="${thumb}" class="table-thumb"></td>
            <td class="table-title"><a href="https://youtube.com/watch?v=${item.video.id}" target="_blank">${v.title}</a></td>
            <td>${v.channelTitle}</td>
            <td>${formatNumber(item.viewCount)}</td>
            <td>${formatNumber(item.subscriberCount)}</td>
            <td style="color:${item.ratio>=1.4?'#8b5cf6':'inherit'};font-weight:bold">${item.ratio.toFixed(2)}x</td>
            <td>${dur}</td>
            <td>${date}</td>`;
          tableBody.appendChild(tr);
        }
      });
    }

    document.getElementById('export-excel-btn').addEventListener('click', () => {
      if(!lastRenderedData.length) return alert("ë°ì´í„° ì—†ìŒ");
      const data = lastRenderedData.map(i => ({
        "ì œëª©": i.video.snippet.title, "ì±„ë„": i.video.snippet.channelTitle,
        "ì¡°íšŒìˆ˜": i.viewCount, "êµ¬ë…ì": i.subscriberCount, "ì ì¬ë ¥": parseFloat(i.ratio.toFixed(2)),
        "ê¸¸ì´": formatDuration(i.video.contentDetails.duration), "ë‚ ì§œ": new Date(i.publishedAtTime).toLocaleDateString(),
        "URL": `https://youtu.be/${i.video.id}`
      }));
      const ws = XLSX.utils.json_to_sheet(data);
      ws['!cols'] = [{wch:40},{wch:20},{wch:10},{wch:10},{wch:10},{wch:10},{wch:15},{wch:40}];
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "YouTube_Data");
      XLSX.writeFile(wb, `YouTube_Analysis_${new Date().toISOString().slice(0,10)}.xlsx`);
    });

    ['length-filter','date-filter','ratio-filter','sort-select'].forEach(id => {
      document.getElementById(id).addEventListener('change', renderVideos);
    });
  </script>
</body>
</html>